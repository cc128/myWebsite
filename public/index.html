<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>个人站</title>
    <!-- <script src="http://www.yanhuangxueyuan.com/threejs/build/three.js"></script> -->
    <script src="js/three.js"></script>
    <!-- <script src="https://d3js.org/d3-array.v1.min.js"></script> -->
    <script src="js/d3-array.v1.min.js"></script>
    <!-- <script src="https://d3js.org/d3-geo.v1.min.js"></script> -->
    <script src="js/d3-geo.v1.min.js"></script>
    <!-- <script src="http://mrdoob.github.io/stats.js/build/stats.min.js"></script> -->
    <script src="js/stats.js"></script>
    <!-- <script src="http://www.yanhuangxueyuan.com/threejs/examples/js/controls/OrbitControls.js"></script> -->
    <script src="js/OrbitControls.js"></script>
    <!-- <script src="http://www.yanhuangxueyuan.com/threejs/examples/js/loaders/STLLoader.js"></script> -->
    <script src="js/STLLoader.js"></script>
    <!-- <script src="http://www.yanhuangxueyuan.com/threejs/examples/js/loaders/OBJLoader.js"></script> -->
    <script src="js//OBJLoader.js"></script>
    <!-- <script src="http://www.yanhuangxueyuan.com/threejs/examples/js/loaders/MTLLoader.js"></script> -->
    <script src="js/MTLLoader.js"></script>
    <script src="js/MeshLine.js"></script>
    <!-- 引入fbx模型加载库FBXLoader -->
    <!-- <script src="http://www.yanhuangxueyuan.com/versions/threejsR92/examples/js/loaders/FBXLoader.js"></script> -->
    <script src="js/FBXLoader.js"></script>
    <!-- 辅助文件 -->
    <!-- <script src="http://www.yanhuangxueyuan.com/versions/threejsR92/examples/js/libs/inflate.min.js"></script> -->
    <script src="js/inflate.js"></script>
    <script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
    <script src="https://cdn.bootcss.com/eruda/1.4.3/eruda.min.js"></script>
    <script>
        eruda.init();
    </script>
</head>
<script>
    //获取内网ip
    var RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
    if (RTCPeerConnection) (
        function () {
            var rtc = new RTCPeerConnection({ iceServers: [] });
            if (1 || window.mozRTCPeerConnection) {
                rtc.createDataChannel('', { reliable: false });
            };

            rtc.onicecandidate = function (evt) {
                if (evt.candidate) grepSDP("a=" + evt.candidate.candidate);
            };
            rtc.createOffer(function (offerDesc) {
                grepSDP(offerDesc.sdp);
                rtc.setLocalDescription(offerDesc);
            }, function (e) { console.warn("offer failed", e); });
            var addrs = Object.create(null);
            addrs["0.0.0.0"] = false;
            function updateDisplay(newAddr) {
                if (newAddr in addrs) return;
                else addrs[newAddr] = true;
                var displayAddrs = Object.keys(addrs).filter(function (k) { return addrs[k]; });
                for (var i = 0; i < displayAddrs.length; i++) {
                    if (displayAddrs[i].length > 16) {
                        displayAddrs.splice(i, 1);
                        i--;
                    }
                }
                //打印出该设备连接的所有内网ip
                console.log(displayAddrs);
                //排第一个ip
                localStorage.setItem("IP", displayAddrs[0])
                console.log(displayAddrs[0]);
            }
            function grepSDP(sdp) {
                var hosts = [];
                sdp.split('\r\n').forEach(function (line, index, arr) {
                    if (~line.indexOf("a=candidate")) {
                        var parts = line.split(' '),
                            addr = parts[4],
                            type = parts[7];
                        if (type === 'host') updateDisplay(addr);
                    } else if (~line.indexOf("c=")) {
                        var parts = line.split(' '),
                            addr = parts[2];
                        updateDisplay(addr);
                    }
                });
            }
        })();
    else {
        console.log("请使用主流浏览器：chrome,firefox,opera,safari");
    }

</script>

<body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
</body>

</html>